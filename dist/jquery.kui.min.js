/*! kui - v0.1.3 - 2015-05-26
* https://github.com/konecta/kui
* Copyright (c) 2015 Nelson Paez; Licensed MIT */
!function(a){a.fn.kui=function(b,c,d){return this.each(function(){a(this).attr("data-kui",!0),b&&(a(this).attr("data-widget",b),a.kui.widgets[b].call(this,c,d))})},a.kui=function(b){return b=a.extend({},a.kui.options,b),"kui"+b.punctuation},a.kui.options={punctuation:"."},a.expr[":"].kui=function(b){return-1!==a(b).text().indexOf("kui")},a.kui.widgets={},a.kui.instances={}}(jQuery),function(a){a.kui.formulario={nuevo_elemento:function(b,c,d,e){var f;b=b||e.soloLectura;var g=a.kui.data.format(d,e.nombre,e.formato,e.opciones,b),h=function(b){return a("<"+b+">").addClass("form-control").attr("data-rol","input").attr("name",e.nombre).attr("placeholder",void 0===e.placeholder?e.titulo:e.placeholder).attr("title",void 0===e.mensaje?"El formato ingresado no es correcto para "+e.titulo:e.mensaje).val(g).prop("required",e.requerido)},i=function(b){void 0!==e.icono&&(b=e.icono);var d=h("input");if(e.simple)d.appendTo(c);else{var f=a("<div>").addClass("input-group").appendTo(c);a("<span>").addClass("input-group-addon").html('<i class="fa fa-'+b+'"></i>').appendTo(f),d.appendTo(f)}return d},j=function(){var d=h(b?"input":"select");if(d.attr("name",e.nombre+"."+e.opciones.id),d.appendTo(c),!b){var f=[];"string"==typeof e.opciones.origen?a.ajax({type:e.opciones.ajax,url:e.opciones.origen,data:void 0===e.opciones.data?{_search:!1,filters:null,page:1,rows:10,sidx:e.opciones.id,sord:"asc",todos:!0}:e.opciones.data,success:function(a){a.error||(f=a.respuesta.datos)},async:!1}):f=e.opciones.origen;var i=!1;a.each(f,function(b,c){var f=a("<option>").attr("value",c[e.opciones.id]).html("function"==typeof e.opciones.formato?e.opciones.formato.call(this,c):c[e.opciones.formato]).appendTo(d);g.toString()===c[e.opciones.id].toString()&&(f.attr("selected",!0),i=!0)}),i||a("<option>").attr("value","").html("").attr("selected",!0).prependTo(d),d.combobox()}return d},k={fecha:{icono:"calendar",formato:"dd/MM/yyyy",rule:"date",constructor:{pickTime:!1}},hora:{icono:"clock-o",formato:"hh:mm:ss",rule:"hour",constructor:{pickDate:!1}},"fecha-hora":{icono:"calendar-o",rule:"datetime",formato:"dd/MM/yyyy hh:mm:ss"}},l=function(c){e.simple=!1;var d=i(k[c].icono),f=d.parent();if(f.addClass("date"),d.attr("data-format",k[c].formato).attr("type","text").attr("data-rule-"+k[c].rule,!0).prependTo(f),!b){f.find(".input-group-addon").addClass("add-on").find("i").attr({"data-time-icon":"fa fa-clock-o","data-date-icon":"fa fa-calendar"});var g={language:"es",autoclose:!0};a.extend(g,k[c].constructor),f.datetimepicker(g);var h=a(".bootstrap-datetimepicker-widget.dropdown-menu");h.find("ul").addClass("list-unstyled"),h.find(".icon-chevron-up").addClass("fa fa-chevron-up"),h.find(".icon-chevron-down").addClass("fa fa-chevron-down"),h.find("th.prev").html(a("<i>").addClass("fa fa-chevron-left").css("font-size","0.5em")),h.find("th.next").html(a("<i>").addClass("fa fa-chevron-right").css("font-size","0.5em"))}return d};switch(e.tipo){case"booleano":f=h("input"),f.appendTo(c),f.prop("type","checkbox"),f.prop("checked",g),f.removeClass("form-control"),c.addClass("checkbox");break;case"numero":f=i("circle-thin"),f.attr("type","number");break;case"decimal":f=i("circle-thin"),f.attr("type","number"),f.attr("step","any");break;case"archivo":f=i("file"),f.attr("type","file");break;case"combo":f=j();break;case"fecha":f=l("fecha");break;case"hora":f=l("hora");break;case"fecha-hora":f=l("fecha-hora");break;default:f=i("align-right"),f.attr("type","text")}if(void 0!==e.atributos){a.each(e.atributos,function(a,b){f.attr(a,b)});var m=["disabled","readonly"];a.each(m,function(a,b){"false"===e.atributos[b]&&f.removeAttr(b),f.attr("data-"+b,e.atributos[b])})}},validar:{reglas:function(){a.validator.methods.date=function(a,b){var c=!1,d=/^\d{1,2}\/\d{1,2}\/\d{4}$/,e=/^\d{1,2}-\d{1,2}-\d{4}$/,f=function(b){var d=a.split(b),e=parseInt(d[0],10),f=parseInt(d[1],10),g=parseInt(d[2],10),h=new Date(g,f-1,e);c=h.getFullYear()===g&&h.getMonth()===f-1&&h.getDate()===e?!0:!1};return d.test(a)?f("/"):e.test(a)?f("-"):c=!1,this.optional(b)||c}},error:function(b,c,d){a.each(b.validElements(),function(b,c){var d=a(c);d.data("title","").removeClass("error").tooltip("destroy"),d.parent().removeClass("has-error")}),a.each(d,function(b,c){var d=a(c.element);d.tooltip("destroy").data("title",c.message).addClass("error").tooltip(),d.parent().addClass("has-error")})},fecha:function(b){a(b).find("input[data-rule-date=true]").each(function(b,c){var d,e=a(c).val(),f={dd:0,MM:1,yyyy:2};e.indexOf("/")>0?d=e.split("/"):(d=e.split("-"),f.yyyy=0,f.dd=2),a(c).val(3===d.length?d[f.yyyy]+"-"+d[f.MM]+"-"+d[f.dd]:"")})}}}}(jQuery),function(a){a.kui.list={actions:function(b){if("string"==typeof b.data){var c=b.instances[b.element.id];if(void 0===c||null===c)return;switch(b.data){case"recargar":void 0!==b.aux&&c.set_data(b.aux),c.cargar();break;case"pagina":if(void 0===b.aux)return;var d=parseInt(b.aux);if(isNaN(d))switch(d=0,b.aux){case"primera":d=1;break;case"anterior":d=parseInt(c.pagina)-1;break;case"siguiente":d=parseInt(c.pagina)+1;break;case"ultima":d=c.totalPaginas;break;default:return}if(1>d||d>parseInt(c.totalPaginas))return;c.set_data({page:d}),c.cargar();break;case"buscar":if(void 0===b.aux)return;var e="AND";void 0!==b.aux.groupOp&&(e=b.aux.groupOp);var f=[];a.each(b.aux.reglas,function(a,c){f.push({field:c.field,data:void 0!==c.data?c.data:b.aux.data,op:void 0!==c.op?c.op:"cn"})}),c.set_data({_search:!0,filters:JSON.stringify({groupOp:e,rules:f})}),c.set_data({page:1}),c.cargar();break;case"seleccionar":c.seleccionar(b.aux);break;case"agregar":c.agregar(b.aux);break;default:return}}else{var g=new b.constructor(b.element,b.data);b.instances[b.element.id]=g}},params:function(b){if(void 0===b.params.url||void 0===b.params.id||void 0===b.params.campos)return void window.console.error("Los campos id, url y campos son obligatorios.");void 0===b.params.ajax&&(b.params.ajax="GET"),void 0===b.params.data&&(b.params.data={}),void 0===b.params.titulos&&(b.params.titulos=!0),void 0===b.params.permisos&&(b.params.permisos={}),void 0===b.params.retorno&&(b.params.retorno={}),void 0===b.params.botones&&(b.params.botones=[]),void 0===b.params.paginador&&(b.params.paginador=a("<div>").addClass("text-center").appendTo(b.div));var c={_search:!1,filters:null,page:1,rows:b.rows,sidx:b.params.id,sord:"asc",todos:!1};a.each(b.params.data,function(a,b){c[a]=b});var d={agregar:null,editar:null,guardar:null,activar:null,remover:null};if(a.each(b.params.permisos,function(a,b){d[a]=b}),b.params.seleccionable){var e={nombre:"kui_seleccionado",titulo:"",tipo:"booleano",ancho:1,editonly:!0,atributos:{"class":b.div.id+"_seleccionar_row"}};b.params.campos.unshift(e),b.params.seleccionados||(b.params.seleccionados=[]),b.list.checkall=a("<input>")}b.list.div=b.div,b.list.url=b.params.url,b.list.data=c,b.list.id=b.params.id,b.list.mostrar_titulos=b.params.titulos,b.list.etiquetas=[],b.list.campos=b.params.campos,b.list.ajax=b.params.ajax,b.list.permisos=d,b.list.botones=b.params.botones,b.list.estado=b.params.estado,b.list.load_complete=b.params.loadComplete,b.list.paginador=b.params.paginador,b.list.onclick=b.params.onclick,b.list.ondblclick=b.params.ondblclick,b.list.seleccionable=b.params.seleccionable,b.list.seleccionados={},b.list.preseleccionados=b.params.seleccionados,b.list.nuevos=0,b.list.enlace_dummy="javascript"+":".toLowerCase()+"void(0)",a.kui.list.cargar_estilos(),a.kui.list.cargar_paginador(b.list),b.list.titulos(),b.list.cargar(),a(b.div).on("reloadGrid",function(){a.kui.instances.kgrid[b.list.id].cargar()})},cargar_paginador:function(b){if(a(b.paginador).length){var c="kui_"+b.div.id+"_",d=a("<div>").attr("id",c+"paginador").addClass("kui-paginador btn-group").appendTo(b.paginador);a("<button>").attr("id",c+"primera_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-step-backward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,"pagina","primera")}),a("<button>").attr("id",c+"pagina_anterior").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-backward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,"pagina","anterior")});var e=a("#"+c+"pagina_anterior").outerHeight(),f=a("#"+c+"pagina_anterior").outerWidth(),g=a("<div>").addClass("btn btn-default kpagina").css("height",e>0?e:34).appendTo(d);a("<label>").html("Página ").appendTo(g),a("<input>").attr("id",c+"pagina").attr("type","text").addClass("pagina").css("width",f>0?f:39).appendTo(g).keyup(function(d){if(13===d.keyCode){d.preventDefault();var e=parseInt(a("#"+c+"pagina").val());if(isNaN(e)||0>e||e>b.totalPaginas)return void a("#"+c+"pagina").val(a("#"+c+"pagina").data("pagina"));e!==a("#"+c+"pagina").data("pagina")&&a("#"+b.div.id).kui(b.name,"pagina",e)}});var h=a("<label>").html(" de ").appendTo(g);a("<span>").attr("id",c+"totalPaginas").appendTo(h),a("<button>").attr("id",c+"siguiente_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-forward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,"pagina","siguiente")}),a("<button>").attr("id",c+"ultima_pagina").attr("type","button").addClass("btn btn-default").html(a("<i>").addClass("fa fa-step-forward")).appendTo(d).click(function(){a("#"+b.div.id).kui(b.name,"pagina","ultima")})}},refrescar_paginador:function(b){a("#kui_"+b.div.id+"_pagina").val(b.pagina).data("pagina",b.pagina),a("#kui_"+b.div.id+"_totalPaginas").html(b.totalPaginas),a("#kui_"+b.div.id+"_primera_pagina").prop("disabled",1===b.pagina),a("#kui_"+b.div.id+"_pagina_anterior").prop("disabled",1===b.pagina),a("#kui_"+b.div.id+"_ultima_pagina").prop("disabled",b.pagina===b.totalPaginas),a("#kui_"+b.div.id+"_siguiente_pagina").prop("disabled",b.pagina===b.totalPaginas)},cargar_estilos:function(){if(!a("#kcard_estilos").length){var b={".kui-list .kbtn":["cursor: pointer"],".kui-list .kbtn:hover":["background: #ECECF0","border: 1px solid #cacaca"],".kui-list h2":["padding-bottom: 10px"],".kui-list .kscore":["width: 0","height: 0","border: 1px solid #999999","background: #ECECF0","font-size: 1.7em","margin-left: 10px","overflow: hidden","border-radius: 50%"],".kui-list .kscore p":["margin-top: 25%"],".kui-list .kscore small":["font-size: 0.5em"],".kui-list .klabel":["margin-top: 20px"],".kui-list .kacciones":["white-space: nowrap"],".kui-list .kaccion":["margin-left: 15px"],".kui-list .kpagina":["overflow: hidden","padding-top: 2px"],".kui-list .kpagina input":["margin: 0 5px","text-align: center"],".kui-list .writing td":["background: #777777"],".kui-list .writing td:not(.kacciones)":["vertical-align: middle","padding: 0 !important"],".kui-list .writing .form-control, .kui-list .writing .input-group-addon":["background: none","box-shadow: none","border-radius: 0","border: none","color: #FFFFFF"],".kui-list .writing .kacciones a":["color: #FFFFFF"]},c="";a.each(b,function(b,d){c+=b+"{",a.each(d,function(a,b){c+=b+";"}),c+="}"});var d=a("head").find("link,style").first(),e=a("<style>").attr("id","kcard_estilos").html(c);d.length?d.before(e):e.prependTo("head")}}}}(jQuery),function(a){a.kui.messages=function(b,c,d,e){b&&b.remove(),b=a("<div>").attr("role","alert").addClass("alert").addClass(d?d:"alert-info").html(e).prependTo(c),a("<button>").attr("data-dismiss","alert").addClass("close").attr("type","button").html('<i class="fa fa-times"></i>').appendTo(b)}}(jQuery),function(a){a.kui.random_id=function(){return"xxxx-xxxx-xxxx".replace(/[x]/g,function(a){var b=16*Math.random()|0,c="x"===a?b:3&b|8;return c.toString(16)}).toUpperCase()},a.kui.data={format:function(a,b,c,d,e){if(d){var f=function(a,b,c){return a[b]?a[b][c]:a[b+"."+c]?a[b+"."+c]:""};return e?"function"==typeof d.formato?d.formato.call(this,a[b]?a[b]:a[b+"."+d.id]):f(a,b,d.formato):f(a,b,d.id)}return"function"==typeof c?c.call(this,a[b],a):a[b]}}}(jQuery),function(a){a.kui.instances.kcard={},a.kui.widgets.cards=function(c,d){return a.kui.list.actions({element:this,constructor:b,instances:a.kui.instances.kcard,data:c,aux:d})};var b=function(b,c){a.kui.list.params({list:this,div:b,params:c,rows:5})};b.prototype={name:"cards",set_data:function(b){var c=this;a.each(b,function(a,b){c.data[a]=b})},nueva_grilla:function(){var b=this;a(b.div).addClass("kui-list form-horizontal"),b.contenido=a("<div>").attr("id",b.div.id+"_grilla").prependTo(b.div),b.seleccionable&&b.seleccionar(b.preseleccionados)},titulos:function(){},cargar:function(){var b=this;b.contenido?b.contenido.empty():b.nueva_grilla(),a.ajax({type:b.ajax,url:b.url,data:b.data,success:function(c){if(c.error)c.mensaje&&a.kui.messages(b.mensaje,b.contenido,c.tipoMensaje,c.mensaje);else{var d=c.respuesta.datos,e={};b.totalDatos=parseInt(c.respuesta.totalDatos),b.pagina=parseInt(c.respuesta.pagina),b.totalPaginas=Math.ceil(b.totalDatos/b.data.rows),b.grilla=a("<div>").addClass("kCard").prependTo(b.contenido),a.each(d,function(a,c){e[c[b.id]]=c,b.cargar_entrada(c)}),a(b.grilla).find("."+b.div.id+"_seleccionar_row").each(function(c,d){b.seleccionados[a(d).data("pk")]&&a(d).attr("checked","checked"),a(d).change(function(){b.cambiar_seleccion(a(d).data("pk"),a(d).is(":checked"))})}),b.grilla.find(".kscore").each(function(b,c){var d=.8*parseInt(a(c).parent().parent().parent().height());a(c).css("width",d),a(c).css("height",d)}),b.grilla.find(".kacciones,.kscores").each(function(b,c){var d=a(c).parent().parent().height()-a(c).height(),e=a(c).next();e.hasClass("kscores")&&!e.is(":empty")?a(c).css("font-size","0.5em"):d/=2,d>0&&a(c).css("padding-top",d)}),a(b.div).data("datos",e),a(b.div).data("totalDatos",b.totalDatos),a(b.div).data("pagina",b.pagina),a(b.div).data("totalPaginas",b.totalPaginas),a.kui.list.refrescar_paginador(b)}"function"==typeof b.load_complete&&b.load_complete.call(this,c)},async:!1})},cargar_entrada:function(b){var c=this,d=void 0===b,e="kCard_"+c.div.id+"_"+(d?"nuevo_"+c.nuevos:b[c.id]),f=d&&c.permisos.agregar?c.permisos.agregar:c.permisos.guardar,g=a("<div>").attr("id",e).attr("data-pk",b[c.id]).addClass("form-group well"),h=d?!0:!1;if(d||"function"!=typeof c.estado||(h=c.estado.call(this,b)),c.onclick){var i="function"==typeof c.onclick?c.onclick:function(){window.open(c.onclick,"_self")};g.addClass("kbtn").click(function(){i.call(this,b)})}else if(c.ondblclick&&("function"==typeof c.ondblclick||h&&"function"==typeof c.permisos.editar)){var j="function"==typeof c.ondblclick?c.ondblclick:function(){c.permisos.editar.call(this,b)};g.dblclick(function(){j.call(this,b)})}var k=a(f?"<form>":"<div>").addClass("col-sm-7").appendTo(g),l=a("<div>").addClass("text-right col-sm-5").appendTo(g),m=a("<div>").addClass("pull-right").addClass("kacciones").appendTo(l),n=a("<div>").addClass("kscores pull-right").appendTo(l);a.each(c.campos,function(c,d){var e;if("score"!==d.tipo){var f=6,g="<p>";("destacado"===d.tipo||"encabezado"===d.tipo)&&(f=12),"encabezado"===d.tipo&&(g="<h2>"),e=a(g).addClass("col-sm-"+f).appendTo(k)}else e=a("<p>").appendTo(a("<div>").addClass("text-center pull-left kscore").appendTo(n));e.html(a.kui.data.format(b,d.nombre,d.formato)),d.titulo&&""!==d.titulo&&("score"!==d.tipo?a("<label>").addClass("text-muted").html(d.titulo+"&nbsp; &nbsp;").prependTo(e):(a("<br>").appendTo(e),a("<small>").html(d.titulo).appendTo(e))),"function"==typeof d.formato&&(b[d.nombre]=d.formato.call(this,b[d.nombre],b))});var o="fa-3x",p=function(b,d,f,g){var h=a("<a>").attr("id",e+"_"+b).addClass("text-muted kaccion").attr("title",d).attr("href",c.enlace_dummy).html('<i class="fa '+o+" fa-"+f+'"></i>').hover(function(){a(this).removeClass("text-muted").addClass("text-"+g)},function(){a(this).addClass("text-muted").removeClass("text-"+g)});return h},q=function(){a("#"+e+" form").find("input[readonly]").each(function(b,c){("true"!==a(c).attr("data-disabled")&&"true"!==a(c).attr("data-readonly")||d&&a(c).attr("data-creable"))&&a(c).removeAttr("readonly").removeAttr("disabled").attr("data-editando",!0).keyup(function(b){13===b.keyCode&&(b.preventDefault(),a("#"+e+" form").submit())})}),a("#"+e+"_editar").hide(),d||(a("#"+e+"_remover").hide(),a("#"+e+"_deshacer").fadeIn()),a("#"+e+"_guardar").fadeIn(),a("#"+e).find("input[data-editando]").first().focus()},r=function(){a("#"+e+" form").find("input[data-editando]").each(function(b,c){a(c).attr("readonly","false"!==a(c).attr("data-readonly")).removeAttr("data-editando").unbind("keyup"),"checkbox"===a(c).attr("type")&&a(c).attr("disabled","false"!==a(c).attr("data-disabled"))}),a("#"+e+"_guardar").hide(),a("#"+e+"_deshacer").hide(),a("#"+e+"_editar").fadeIn(),a("#"+e+"_remover").fadeIn()},s=function(){var b=a(c.div).data("datos")[a("#"+e).attr("data-pk")],d=a("#"+e+" form").find("input[data-editando]");r(),d.each(function(c,d){"checkbox"===a(d).attr("type")?a(d).prop("checked",b[a(d).attr("name")]):a(d).val(b[a(d).attr("name")])})};if(h){if(c.permisos.editar){var t=p("editar","Editar","pencil","primary");if("function"==typeof c.permisos.editar)t.click(function(a){a.stopPropagation(),c.permisos.editar.call(this,b)});else if(f){var u=p("guardar","Guardar","save","primary");u.hide();var v="function"==typeof f?function(a){f.call(this,a)}:function(b){a.ajax({type:"POST",url:f,data:b,success:function(){c.cargar()}})};a.kui.formulario.validar.reglas(),a(k).validate({showErrors:function(b,c){a.kui.formulario.validar.error(this,b,c)},submitHandler:function(c){a.kui.formulario.validar.fecha(c),r();var d={};return a.each(a("#"+e+" form").serializeArray(),function(a,b){d[b.name]=b.value}),a.each(a("#"+e+" form input[data-rol=input][type=checkbox]"),function(b,c){d[a(c).attr("name")]=a(c).is(":checked")}),d=a.extend({},b,d),v(d),!1}}),u.click(function(b){b.stopPropagation(),a("#"+e+" form").submit()}).appendTo(m);var w=p("deshacer","Deshacer cambios","undo","danger");w.hide().click(function(a){a.stopPropagation(),s()}).appendTo(m),t.click(function(a){a.stopPropagation(),q()})}d||t.appendTo(m)}if(c.permisos.remover){var x=p("remover","Remover","times","danger");d||"function"!=typeof c.permisos.remover?x.click(function(b){b.stopPropagation(),a("#"+e).remove()}):x.click(function(a){a.stopPropagation(),c.permisos.remover.call(this,b)}),x.appendTo(m)}}else if("function"==typeof c.permisos.activar){g.addClass("has-error");var y=p("reactivar","Reactivar","check","success");y.click(function(a){a.stopPropagation(),c.permisos.activar.call(this,b)}).appendTo(m)}if(c.botones.length){var z=function(b){a(b).appendTo(m)};a.each(c.botones,function(d,e){if("function"!=typeof e.mostrar||e.mostrar.call(this,b)){var f=p(a.kui.random_id(),e.comentario,e.icono,"primary");f.attr("href",void 0!==e.enlace?e.enlace:c.enlace_dummy),void 0!==e.onclick&&f.click(function(a){a.stopPropagation(),e.onclick.call(this,b)}),void 0!==e.atributos&&a.each(e.atributos,function(a,b){f.attr(a,b)}),z(f)}})}d?(g.prependTo(c.grilla),q()):g.appendTo(c.grilla)},cambiar_seleccion:function(a,b){var c=this;c.seleccionados[a]=b,c.refrescar_seleccionados()},seleccionar:function(b){var c=this;c.seleccionados={},a.each(b,function(a,b){c.seleccionados[b]=!0}),a("."+c.div.id+"_seleccionar_row").each(function(b,d){a(d).removeAttr("checked"),c.seleccionados[a(d).data("pk")]&&a(d).prop("checked",!0)}),c.refrescar_seleccionados()},refrescar_seleccionados:function(){var b=this,c=[];a.each(b.seleccionados,function(a,b){b&&c.push(a)}),a(b.div).data("seleccionados",c);var d=a(b.div).find("."+b.div.id+"_seleccionar_row:checked").length;b.checkall.prop("checked",d>0&&a(b.div).find("."+b.div.id+"_seleccionar_row").length===d)},agregar:function(a){var b=this;b.cargar_entrada(a)}}}(jQuery),function(a){a.kui.instances.kform={},a.fn.kForm=function(b){return a(this).kui("form",b)},a.kui.widgets.form=function(c){return a.kui.instances.kform[this.id]=new b(this,c)};var b=function(a,b){return void 0===b.campos||void 0===b.submit?void window.console.error('Los parámetros "campos" y "submit" son obligatorios.'):(this.div=a,this.campos=b.campos,this.submit=b.submit,this.origen=b.origen,this.ajax_origen=void 0===b.ajaxOrigen?"GET":b.ajaxOrigen,this.ajax_submit=void 0===b.ajaxSubmit?"POST":b.ajaxSubmit,this.load_complete=b.loadComplete,this.boton_submit=b.botonSubmit,this.soloLectura=void 0===b.soloLectura?!1:b.soloLectura,this.data_origen=b.dataOrigen,this.after_submit=b.afterSubmit,void this.cargar())};b.prototype={nuevo_form:function(){var b=this;b.form=a("<form>").attr("id",b.div.id+"_form").addClass("kform form-horizontal").attr("action","#").prependTo(b.div),b.seleccionable&&b.seleccionar(b.preseleccionados)},cargar:function(){var b=this;b.form?b.form.empty():b.nuevo_form(),void 0===b.origen?b.dato={}:"string"==typeof b.origen?a.ajax({type:b.ajax_origen,url:b.origen,data:b.data_origen,success:function(a){a.error||(b.dato=a.objeto)},async:!1}):b.dato=b.origen,b.cargar_campos()},cargar_campos:function(){var b=this,c=b.dato;b.fieldset=a("<fieldset>").appendTo(b.form),b.soloLectura&&b.fieldset.attr("disabled",!0),a.each(b.campos,function(d,e){var f=a("<div>").addClass("form-group"+(e.oculto?" hidden":"")).appendTo(b.fieldset);void 0===e.titulo&&(e.titulo=e.nombre),a("<label>").addClass("klabel col-sm-4 control-label").html(e.titulo).appendTo(f);var g=a("<div>").addClass("col-sm-8").appendTo(f);a.kui.formulario.nuevo_elemento(b.soloLectura,g,c,e)}),a(b.div).data("dato",b.dato),b.funcion_submit(),"function"==typeof b.load_complete&&b.load_complete.call(this,b.dato)},funcion_submit:function(){var b=this;void 0===b.boton_submit?b.boton_submit=a("<button>").addClass("btn btn-primary").html("Guardar").appendTo(a("<div>").addClass("form-group text-right").appendTo(b.fieldset)):b.boton_submit=a(b.boton_submit),b.boton_submit.click(function(a){a.preventDefault(),b.form.submit()}),a.kui.formulario.validar.reglas();var c="function"==typeof b.after_submit?function(a){b.after_submit.call(this,a)}:function(){},d="function"==typeof b.submit?function(){c(b.submit.call(this,b.contenido(),b.dato))}:function(){a.ajax({type:b.ajax_submit,url:b.submit,data:b.contenido(),success:function(d){d.mensaje&&a.kui.messages(b.mensaje,b.div,d.tipoMensaje,d.mensaje),c(d)},async:!1})};a(b.form).validate({showErrors:function(b,c){a.kui.formulario.validar.error(this,b,c)},submitHandler:function(b){return a.kui.formulario.validar.fecha(b),d(),!1}})},contenido:function(){var b=this,c={};return a.each(b.form.serializeArray(),function(a,b){c[b.name]=b.value}),a.each(b.form.find("input[data-rol=input][type=checkbox]"),function(b,d){c[a(d).attr("name")]=a(d).is(":checked")}),c}}}(jQuery),function(a){a.kui.instances.kgrid={},a.fn.kGrid=function(b,c){return a(this).kui("grid",b,c)},a.kui.widgets.grid=function(c,d){return a.kui.list.actions({element:this,constructor:b,instances:a.kui.instances.kgrid,data:c,aux:d})};var b=function(b,c){a.kui.list.params({list:this,div:b,params:c,rows:10})};b.prototype={name:"grid",set_data:function(b){var c=this;a.each(b,function(a,b){c.data[a]=b})},nueva_grilla:function(){var b=this;a(b.div).addClass("kui-list"),b.table=a("<table>").addClass("table table-bordered table-striped").prependTo(a("<div>").addClass("table-responsive").prependTo(b.div)),b.tbody=a("<tbody>").attr("id",b.div.id+"_grilla").prependTo(b.table),b.seleccionable&&b.seleccionar(b.preseleccionados),a.kui.formulario.validar.reglas()},titulos:function(){var b=this;if(b.nueva_grilla(),b.mostrar_titulos){var c=a("<tr>");b.thead=a("<thead>").prependTo(b.table),a.each(b.campos,function(d,e){var f=a("<strong>");void 0!==e.titulo?f.append(e.titulo):f.append(e.nombre);var g=a("<th>").html(f).appendTo(c);b.seleccionable&&0===d&&(g.addClass("text-center"),b.checkall.attr("id",b.div.id+"_seleccionar_todo").attr("type","checkbox").change(function(){var c=a(this).is(":checked");a("."+b.div.id+"_seleccionar_row").each(function(b,d){a(d).prop("checked",c),a(d).trigger("change")})}),f.html(b.checkall))}),a("<th>").addClass("kacciones").appendTo(c),c.appendTo(b.thead)}},cargar:function(){var b=this;b.tbody?b.tbody.empty():b.nueva_grilla(),a.ajax({type:b.ajax,url:b.url,data:b.data,success:function(c){if(c.error)c.mensaje&&a.kui.messages(b.mensaje,b.tbody,c.tipoMensaje,c.mensaje);else{var d=c.respuesta.datos,e={};b.totalDatos=parseInt(c.respuesta.totalDatos),b.pagina=parseInt(c.respuesta.pagina),b.totalPaginas=Math.ceil(b.totalDatos/b.data.rows),a.each(d,function(a,c){e[c[b.id]]=c,b.cargar_entrada(c)}),a(b.tbody).find("."+b.div.id+"_seleccionar_row").each(function(c,d){b.seleccionados[a(d).data("pk")]&&a(d).attr("checked","checked"),a(d).change(function(){b.cambiar_seleccion(a(d).data("pk"),a(d).is(":checked"))})}),a(b.div).data("datos",e),a(b.div).data("totalDatos",b.totalDatos),a(b.div).data("pagina",b.pagina),a(b.div).data("totalPaginas",b.totalPaginas),a.kui.list.refrescar_paginador(b)}"function"==typeof b.load_complete&&b.load_complete.call(this,c)},async:!1})},cargar_entrada:function(b){var c=this,d=void 0===b,e="kGrid_"+c.div.id+"_"+(d?"nuevo_"+c.nuevos:b[c.id]),f=d&&c.permisos.agregar?c.permisos.agregar:c.permisos.guardar;if(d){if(a("#"+e).is(":visible")){var g=a("#"+e).find('[data-rol="input"]:not([disabled],[readonly])').first();return void(g.length?g.focus():(c.nuevos++,c.cargar_entrada(b)))}if(!f)return void window.console.error('Para agregar entradas vacías debe configurar el permiso "agregar" o "guardar"');b={}}var h=a("<tr>").attr("id",e).attr("data-pk",b[c.id]),i=d?!0:!1;if(d||"function"!=typeof c.estado||(i=c.estado.call(this,b)),c.onclick){var j="function"==typeof c.onclick?c.onclick:function(){window.open(c.onclick,"_self")};h.addClass("kbtn").click(function(){j.call(this,b)})}else if(c.ondblclick&&("function"==typeof c.ondblclick||i&&"function"==typeof c.permisos.editar)){var k="function"==typeof c.ondblclick?c.ondblclick:function(){c.permisos.editar.call(this,b)};h.dblclick(function(){k.call(this,b)})}a.each(c.campos,function(d,e){var f=a("<td>").attr("data-cell",!0).data("campo",e).appendTo(h),g=a.kui.data.format(b,e.nombre,e.formato,e.opciones,!0),i=a("<div>").attr("data-view",!0).data("original",g).appendTo(f);"booleano"===e.tipo?(a.kui.formulario.nuevo_elemento(!1,i,b,e),f.find("[data-rol=input]").prop("disabled",!e.editonly).attr("data-pk",b[c.id]).dblclick(function(a){a.stopPropagation()}),f.addClass("text-center"),i.removeClass("checkbox")):i.html(g)});var l=a("<td>").addClass("kacciones").appendTo(h),m="fa-lg",n=function(b,d,f,g){var h=a("<a>").attr("id",e+"_"+b).addClass("text-muted kaccion").attr("title",d).attr("href",c.enlace_dummy).html('<i class="fa '+m+" fa-"+f+'"></i>').hover(function(){a(this).removeClass("text-muted").addClass("text-"+g)},function(){a(this).addClass("text-muted").removeClass("text-"+g)});return h},o=function(){if(!a("#"+e).data("formulario")){var b=a(c.div).data("datos")[a("#"+e).attr("data-pk")];b||(b={}),a("#"+e).find("[data-cell]").each(function(d,f){var g=a(f).data("campo"),h=a("<form>").attr("data-edit",!0).appendTo(f).hide();a.kui.formulario.nuevo_elemento(!1,h,b,g),"booleano"===g.tipo&&h.removeClass("checkbox").find("[data-rol=input]").attr("data-pk",b[c.id]).dblclick(function(a){a.stopPropagation()}),h.validate({showErrors:function(b,c){a.kui.formulario.validar.error(this,b,c)},submitHandler:function(b){a.kui.formulario.validar.fecha(b);var c=a("#"+e).data("ready");return a("#"+e).data("ready",++c),!1}})}),a("#"+e).data("formulario",!0)}a("#"+e).find("[data-cell]").each(function(b,c){a(c).css({width:a(c).outerWidth(),height:a(c).outerHeight()})}),a("#"+e).find("[data-view]").hide(),a("#"+e).addClass("writing"),a("#"+e).find("[data-edit]").show(),a("#"+e+"_editar").hide(),d||(a("#"+e+"_remover").hide(),a("#"+e+"_deshacer").fadeIn()),a("#"+e+"_guardar").fadeIn(),a("#"+e).find('[data-rol="input"]:not([disabled],[readonly])').first().focus()},p=function(){a("#"+e).find("[data-edit]").hide(),a("#"+e).removeClass("writing"),a("#"+e).find("[data-view]").fadeIn(),a("#"+e).find("[data-cell]").removeAttr("style"),a("#"+e+"_guardar").hide(),a("#"+e+"_deshacer").hide(),a("#"+e+"_editar").fadeIn(),a("#"+e+"_remover").fadeIn()},q=function(){p(),a("#"+e).find("[data-view]").each(function(b,c){var d=a(c).data("original"),e=a(c).parent().find("[data-rol=input]");"checkbox"===a(e).attr("type")?a(e).prop("checked",d):a(e).val(d)})};if(i){var r=n("editar","Editar","pencil","primary");if(c.permisos.editar&&!d&&"function"==typeof c.permisos.editar)r.click(function(a){a.stopPropagation(),c.permisos.editar.call(this,b)});else if(f){var s=n("guardar","Guardar","save","primary");s.hide();var t="function"==typeof f?function(a){f.call(this,a)}:function(b){a.ajax({type:"POST",url:f,data:b,success:function(){c.cargar()}})};s.click(function(b){b.stopPropagation(),a("#"+e).data("ready",0);var c=a("#"+e+" form");if(c.each(function(b,c){a(c).submit()}),a("#"+e).data("ready")===c.length){p();var d={};c.each(function(b,c){var e=a(c).serializeArray(),f="";e.length?a.each(e,function(a,b){f=d[b.name]=b.value}):f=a(c).find("[data-rol=input]").val(),a(c).parent().find("[data-view]").each(function(b,c){var e=a(c).parent().find("[data-edit] [data-rol=input]");a(c).empty(),a(e).is("[type=checkbox]")?(d[a(e).attr("name")]=a(e).is(":checked"),a(e).clone().prop("disabled",!0).attr("data-pk",a(c).parent().parent().data("pk")).appendTo(c)):a(e).is("select")?a(c).html(a(e).find('option[value="'+f+'"]').text()):a(c).html(f)})}),t(d)}}).appendTo(l);var u=n("deshacer","Deshacer cambios","undo","danger");u.hide().click(function(a){a.stopPropagation(),q()}).appendTo(l),r.click(function(a){a.stopPropagation(),o()}),d||r.appendTo(l)}if(c.permisos.remover||d){var v=n("remover","Remover","times","danger");d||"function"!=typeof c.permisos.remover?v.click(function(b){b.stopPropagation(),a("#"+e).remove()}):v.click(function(a){a.stopPropagation(),c.permisos.remover.call(this,b)}),v.appendTo(l)}}else if("function"==typeof c.permisos.activar){h.addClass("has-error");var w=n("reactivar","Reactivar","check","success");w.click(function(a){a.stopPropagation(),c.permisos.activar.call(this,b)}).appendTo(l)}if(c.botones.length){var x;if(1===c.botones.length)x=function(b){a(b).appendTo(l)};else{var y=a("<div>").attr("id",a.kui.random_id()).addClass("kui-dropdown").appendTo("body"),z=a("<ul>").attr("role","menu").addClass("dropdown-menu").appendTo(y),A=n(a.kui.random_id(),"Acciones","angle-down","primary");A.attr("data-toggle","dropdown").attr("aria-haspopup",!0).attr("aria-expanded",!1).appendTo(l);var B=A.parent().attr("id",a.kui.random_id()).addClass("dropdown kui-dropdown"),C=z.clone().attr("aria-labelledby",A.attr("id")).appendTo(B);x=function(b){b.find("i.fa").addClass("fa-fw").removeClass("fa-lg"),a("<span>").html(" "+b.attr("title")).appendTo(b);var c=a("<li>").attr("role","presentation").appendTo(C);a(b).appendTo(c),c.clone().appendTo(z)},a(h).attr("data-toggle","context").attr("data-target","#"+y.attr("id"));var D=function(){var b=this.id;a(".kui-dropdown.open").each(function(c,d){d.id!==b&&a(d).removeClass("open")}),c.table.parent().addClass("kui-grid-dropdown-open")};y.on("show.bs.context",D),B.on("show.bs.dropdown",D);var E=function(){c.table.parent().removeClass("kui-grid-dropdown-open")};y.on("hide.bs.context",E),B.on("hide.bs.dropdown",E)}a.each(c.botones,function(d,e){if("function"!=typeof e.mostrar||e.mostrar.call(this,b)){var f=n(a.kui.random_id(),e.comentario,e.icono,"primary");f.attr("href",void 0!==e.enlace?e.enlace:c.enlace_dummy),void 0!==e.onclick&&f.click(function(a){a.stopPropagation(),e.onclick.call(this,b)}),void 0!==e.atributos&&a.each(e.atributos,function(a,b){f.attr(a,b)}),x(f)}})}d?(h.prependTo(c.tbody),o(),h.find("[data-creable]").removeAttr("readonly").removeAttr("disabled")):h.appendTo(c.tbody)},cambiar_seleccion:function(a,b){var c=this;c.seleccionados[a]=b,c.refrescar_seleccionados()},seleccionar:function(b){var c=this;c.seleccionados={},a.each(b,function(a,b){c.seleccionados[b]=!0}),a("."+c.div.id+"_seleccionar_row").each(function(b,d){a(d).removeAttr("checked"),c.seleccionados[a(d).data("pk")]&&a(d).prop("checked",!0)}),c.refrescar_seleccionados()},refrescar_seleccionados:function(){var b=this,c=[];a.each(b.seleccionados,function(a,b){b&&c.push(a)}),a(b.div).data("seleccionados",c);
var d=a(b.div).find("."+b.div.id+"_seleccionar_row:checked").length;b.checkall.prop("checked",d>0&&a(b.div).find("."+b.div.id+"_seleccionar_row").length===d)},agregar:function(a){var b=this;b.cargar_entrada(a)}}}(jQuery),function(a){a.kui.instances.wizard={},a.kui.widgets.wizard=function(c){return a.kui.instances.wizard[this.id]=new b(this,c)};var b=function(b,c){return void 0===c.pasos?void window.console.error('Los parámetros "pasos" y "" son obligatorios.'):(a.extend(this,c),this.div=b,void this.cargar())};b.prototype={cargar:function(){var b=this,c=a(b.div);c.hide().attr("data-wizard",!0).attr("data-step","0"),"string"==typeof b.pasos&&(c.find(b.pasos).each(function(b,c){a(c).hide().attr("data-wizard-step",!0).attr("data-step",b+1)}),c.find(b.indices).each(function(b,c){a(c).removeClass("active").attr("data-wizard-index",!0).attr("data-index",b+1)})),b.control={},b.control.prev=b.anterior?a(b.anterior):a("<button>").addClass("btn btn-default").appendTo(c),b.control.next=b.siguiente?a(b.siguiente):a("<button>").addClass("btn btn-primary").appendTo(c),b.control.prev.click(function(){var a=parseInt(c.attr("data-step"));b.mostrarPaso(a-1)}),b.control.next.click(function(){var a=parseInt(c.attr("data-step"));b.validar(a)&&b.mostrarPaso(a+1)}),"function"==typeof b.loadComplete&&b.loadComplete.call(this),b.mostrarPaso(1),c.fadeIn()},validar:function(b){var c=this,d=!0,e=a(c.div).find('[data-wizard-step][data-step="'+b+'"]');return"function"==typeof c.validacion&&(d=c.validacion.call(this,e)),d},mostrarPaso:function(b){var c=this,d=a(c.div),e=d.find('[data-wizard-step][data-step="'+b+'"]');if(e.length){var f=d.find("[data-wizard-step]:visible");f.trigger("hide").hide().trigger("hidden"),d.find("[data-wizard-index]").removeClass("active"),d.find('[data-wizard-index][data-index="'+b+'"]').addClass("active"),d.attr("data-step",b),c.control.prev.prop("disabled",1===b),c.control.next.prop("disabled",b===d.find("[data-wizard-step]").length),e.trigger("show").fadeIn("slow",function(){e.trigger("shown")})}}}}(jQuery);